Mad-Assembler v1.6.?beta by TeBe/Madteam
Source: D:\!Atari\getris2\game_over\msx\game_over.asm
     1 				;
     2 				; MUSIC init & play
     3 				; example by Raster/C.P.U., 2003-2004
     4 				;
     5 				;
     6 = 00,D40B		VCOUNT		equ $d40b			;vertical screen lines counter address
     7 = 00,0010		VLINE		equ 16				;screen line for synchronization
     8 = 00,0000		STEREOMODE	equ 0				;0 => compile RMTplayer for mono 4 tracks
     9
    10 					org $4000					;RMT module is standard Atari binary file already
    11 FFFF> 00,4000-4394> 52 +	MODUL	ins "maynoaise.rmt",6				;include music RMT module
    12
    13 				;								;1 => compile RMTplayer for stereo 8 tracks
    14 				;								;2 => compile RMTplayer for 4 tracks stereo L1 R2 R3 L4
    15 				;								;3 => compile RMTplayer for 4 tracks stereo L1 L2 R3 R4
    16
    17 00,4395				org $4400-3
    18 00,43FD-43FF> 4C 68 4D		jmp start+3
    19
    20 					.ds $400
    20 00,4400			org *+ $400
    21
    22 00,4800			PLAYER	icl "rmtplayr.a65"			;include RMT player routine
Source: D:\!Atari\getris2\game_over\msx\rmtplayr.a65
     1 				;*
     2 				;* Raster Music Tracker, RMT Atari routine version 1.20050413
     3 				;* (c) Radek Sterba, Raster/C.P.U., 2002 - 2005
     4 				;* http://raster.atari.org
     5 				;*
     6 				;* Warnings:
     7 				;*
     8 				;* 1. RMT player routine needs 19 itself reserved bytes in zero page (no accessed
     9 				;*    from any other routines) as well as cca 1KB of memory before the "PLAYER"
    10 				;*    address for frequency tables and functionary variables. It's:
    11 				;*	  a) from PLAYER-$400 to PLAYER for stereo RMTplayer
    12 				;*    b) from PLAYER-$380 to PLAYER for mono RMTplayer
    13 				;*
    14 				;* 2. RMT player routine MUST (!!!) be compiled from the begin of the memory page.
    15 				;*    i.e. "PLAYER" address can be $..00 only!
    16 				;*
    17 				;* 3. Because of RMTplayer provides a lot of effects, it spent a lot of CPU time.
    18 				;*
    19 				;* STEREOMODE	equ 0				;0 => compile RMTplayer for 4 tracks mono
    20 				;*									;1 => compile RMTplayer for 8 tracks stereo
    21 				;*									;2 => compile RMTplayer for 4 tracks stereo L1 R2 R3 L4
    22 				;*									;3 => compile RMTplayer for 4 tracks stereo L1 L2 R3 R4
    23 				;*
    24 				;PLAYER		equ $3400
    25 				;*
    26 					IFT STEREOMODE==1
    27 				TRACKS		equ 8
    28 					ELS
    29 = 00,0004		TRACKS		equ 4
    30 					EIF
    31 				;*
    32 				;* RMT FEATures definitions file
    33 				;* For optimizations of RMT player routine to concrete RMT modul only!
    34 00,4800				icl "rmt_feat.a65"
Source: D:\!Atari\getris2\game_over\msx\rmt_feat.a65
     1 				;*
     2 				;* RMT FEATures definitions
     3 				;* For optimizations of RMT player routine to concrete RMT modul only!
     4 				;* --------BEGIN--------
     5 = 00,0001		FEAT_COMMAND1		equ 1			;* cca 8 bytes
     6 = 00,0001		FEAT_COMMAND2		equ 1			;* cca 20 bytes (+save 1 address in zero page) and quicker whole RMT routine
     7 = 00,0001		FEAT_COMMAND3		equ 1			;* cca 12 bytes
     8 = 00,0001		FEAT_COMMAND4		equ 1			;* cca 15 bytes
     9 = 00,0001		FEAT_COMMAND5		equ 1			;* cca 67 bytes
    10 = 00,0001		FEAT_COMMAND6		equ 1			;* cca 15 bytes
    11 				;* COMMAND7 SETNOTE (i.e. command 7 with parameter != $80)
    12 = 00,0001		FEAT_COMMAND7SETNOTE		equ 1		;* cca 12 bytes
    13 				;* COMMAND7 VOLUMEONLY (i.e. command 7 with parameter == $80)
    14 = 00,0001		FEAT_COMMAND7VOLUMEONLY		equ 1		;* cca 74 bytes
    15 				;* PORTAMENTO
    16 = 00,0001		FEAT_PORTAMENTO		equ 1			;* cca 138 bytes and quicker whole RMT routine
    17 				;* FILTER
    18 = 00,0001		FEAT_FILTER			equ 1			;* cca 179 bytes and quicker whole RMT routine
    19 = 00,0001		FEAT_FILTERG0L		equ	1			;* (cca 38 bytes for each)
    20 = 00,0001		FEAT_FILTERG1L		equ	1
    21 = 00,0001		FEAT_FILTERG0R		equ	1
    22 = 00,0001		FEAT_FILTERG1R		equ	1
    23 				;* BASS16B (i.e. distortion value 6)
    24 = 00,0001		FEAT_BASS16			equ 1			;* cca 194 bytes +128bytes freq table and quicker whole RMT routine
    25 = 00,0001		FEAT_BASS16G1L		equ 1			;* (cca 47 bytes for each)
    26 = 00,0001		FEAT_BASS16G3L		equ 1
    27 = 00,0001		FEAT_BASS16G1R		equ 1
    28 = 00,0001		FEAT_BASS16G3R		equ 1
    29 				;* VOLUME ONLY for particular generators
    30 = 00,0001		FEAT_VOLUMEONLYG0L	equ 1			;* (cca 7 bytes for each)
    31 = 00,0001		FEAT_VOLUMEONLYG2L	equ 1
    32 = 00,0001		FEAT_VOLUMEONLYG3L	equ 1
    33 = 00,0001		FEAT_VOLUMEONLYG0R	equ 1
    34 = 00,0001		FEAT_VOLUMEONLYG2R	equ 1
    35 = 00,0001		FEAT_VOLUMEONLYG3R	equ 1
    36 				;* TABLE TYPE (i.e. TABLETYPE=1)
    37 = 00,0001		FEAT_TABLETYPE		equ 1			;* cca 53 bytes and quicker whole RMT routine
    38 				;* TABLE MODE (i.e. TABLEMODE=1)
    39 = 00,0001		FEAT_TABLEMODE		equ 1			;* cca 16 bytes and quicker whole RMT routine
    40 				;* TABLE GO (i.e. TGO is nonzero value)
    41 = 00,0001		FEAT_TABLEGO		equ 1			;* cca 6 bytes and quicker whole RMT routine
    42 				;* AUDCTLMANUALSET (i.e. any MANUAL AUDCTL setting is nonzero value)
    43 = 00,0001		FEAT_AUDCTLMANUALSET	equ 1		;* cca 27 bytes and quicker whole RMT routine
    44 				;* VOLUME MINIMUM (i.e. VMIN is nonzero value)
    45 = 00,0001		FEAT_VOLUMEMIN		equ 1			;* cca 12 bytes and quicker whole RMT routine
    46 				;* --------END--------
Source: D:\!Atari\getris2\game_over\msx\rmtplayr.a65
    35 				;*
    36 				;* RMT ZeroPage addresses
    37 00,4800				org $cb
    38 00,00CB			p_tis
    39 00,00CB			p_instrstable		org *+2
    40 00,00CD			p_trackslbstable	org *+2
    41 00,00CF			p_trackshbstable	org *+2
    42 00,00D1			p_song			org *+2
    43 00,00D3			ns			org *+2
    44 00,00D5			nr			org *+2
    45 00,00D7			nt			org *+2
    46 00,00D9			reg1			org *+1
    47 00,00DA			reg2			org *+1
    48 00,00DB			reg3			org *+1
    49 00,00DC			tmp			org *+1
    50
    51 					IFT FEAT_COMMAND2
    52 00,00DD			frqaddcmd2		org *+1
    53 					EIF
    54
    55 					IFT TRACKS>4
    56 					org PLAYER-$400
    57 					ELS
    58 00,00DE				org PLAYER-$380
    59 					EIF
    60
    61 00,4480			track_variables
    62 00,4480			trackn_db	org *+TRACKS
    63 00,4484			trackn_hb	org *+TRACKS
    64 00,4488			trackn_idx	org *+TRACKS
    65 00,448C			trackn_pause	org *+TRACKS
    66 00,4490			trackn_note	org *+TRACKS
    67 00,4494			trackn_volume	org *+TRACKS
    68 00,4498			trackn_distor 	org *+TRACKS
    69 00,449C			trackn_shiftfrq	org *+TRACKS
    70 					IFT FEAT_PORTAMENTO
    71 00,44A0			trackn_portafrqc org *+TRACKS
    72 00,44A4			trackn_portafrqa org *+TRACKS
    73 00,44A8			trackn_portaspeed org *+TRACKS
    74 00,44AC			trackn_portaspeeda org *+TRACKS
    75 00,44B0			trackn_portadepth org *+TRACKS
    76 					EIF
    77 00,44B4			trackn_instrx2	org *+TRACKS
    78 00,44B8			trackn_instrdb	org *+TRACKS
    79 00,44BC			trackn_instrhb	org *+TRACKS
    80 00,44C0			trackn_instridx	org *+TRACKS
    81 00,44C4			trackn_instrlen	org *+TRACKS
    82 00,44C8			trackn_instrlop	org *+TRACKS
    83 00,44CC			trackn_instrreachend	org *+TRACKS
    84 00,44D0			trackn_volumeslidedepth org *+TRACKS
    85 00,44D4			trackn_volumeslidevalue org *+TRACKS
    86 					IFT FEAT_VOLUMEMIN
    87 00,44D8			trackn_volumemin		org *+TRACKS
    88 					EIF
    89 00,44DC			trackn_effdelay			org *+TRACKS
    90 00,44E0			trackn_effvibratoa		org *+TRACKS
    91 00,44E4			trackn_effvibratobeg	org *+TRACKS
    92 00,44E8			trackn_effvibratoend	org *+TRACKS
    93 00,44EC			trackn_effshift		org *+TRACKS
    94 00,44F0			trackn_tabletypespeed org *+TRACKS
    95 					IFT FEAT_TABLEMODE
    96 00,44F4			trackn_tablemode	org *+TRACKS
    97 					EIF
    98 00,44F8			trackn_tablenote	org *+TRACKS
    99 00,44FC			trackn_tablea		org *+TRACKS
   100 00,4500			trackn_tableend		org *+TRACKS
   101 					IFT FEAT_TABLEGO
   102 00,4504			trackn_tablelop		org *+TRACKS
   103 					EIF
   104 00,4508			trackn_tablespeeda	org *+TRACKS
   105 00,450C			trackn_command		org *+TRACKS
   106 					IFT FEAT_BASS16
   107 00,4510			trackn_outnote		org *+TRACKS
   108 					EIF
   109 					IFT FEAT_FILTER
   110 00,4514			trackn_filter		org *+TRACKS
   111 					EIF
   112 00,4518			trackn_audf	org *+TRACKS
   113 00,451C			trackn_audc	org *+TRACKS
   114 					IFT FEAT_AUDCTLMANUALSET
   115 00,4520			trackn_audctl	org *+TRACKS
   116 					EIF
   117 00,4524			v_audctl		org *+1
   118 00,4525			v_audctl2		org *+1
   119 00,4526			v_speed			org *+1
   120 00,4527			v_aspeed		org *+1
   121 00,4528			v_bspeed		org *+1
   122 00,4529			v_instrspeed	org *+1
   123 00,452A			v_ainstrspeed	org *+1
   124 00,452B			v_maxtracklen	org *+1
   125 00,452C			v_abeat			org *+1
   126 00,452D			track_endvariables
   127 00,452D					org PLAYER-$100-$140-$30
   128 = 00,000C		INSTRPAR	equ 12
   129 00,4590			tabbeganddistor
   130 00,4590-45B9> 80 00	 dta frqtabpure-frqtab,$00
   131 00,4592 80 20		 dta frqtabpure-frqtab,$20
   132 00,4594 80 40		 dta frqtabpure-frqtab,$40
   133 00,4596 00 C0		 dta frqtabbass1-frqtab,$c0
   134 00,4598 80 80		 dta frqtabpure-frqtab,$80
   135 00,459A 80 A0		 dta frqtabpure-frqtab,$a0
   136 00,459C 00 C0		 dta frqtabbass1-frqtab,$c0
   137 00,459E 40 C0		 dta frqtabbass2-frqtab,$c0
   138 00,45A0 00 01 05 0B 15	vibtabbeg dta 0,vib1-vib0,vib2-vib0,vib3-vib0,vibx-vib0
   139 00,45A5 00		vib0	dta 0
   140 00,45A6 01 FF FF 01	vib1	dta 1,-1,-1,1
   141 00,45AA 01 00 FF FF 00 +	vib2	dta 1,0,-1,-1,0,1
   142 00,45B0 01 01 00 FF FF +	vib3	dta 1,1,0,-1,-1,-1,-1,0,1,1
   143 00,45BA			vibx
   144 00,45BA					org PLAYER-$100-$140
   145 					IFT FEAT_BASS16
   146 00,45C0			frqtabbasslo
   147 00,45C0-4D9F> F2 33 96 +		dta $F2,$33,$96,$E2,$38,$8C,$00,$6A,$E8,$6A,$EF,$80,$08,$AE,$46,$E6
   148 00,45D0 95 41 F6 B0 6E +		dta $95,$41,$F6,$B0,$6E,$30,$F6,$BB,$84,$52,$22,$F4,$C8,$A0,$7A,$55
   149 00,45E0 34 14 F5 D8 BD +		dta $34,$14,$F5,$D8,$BD,$A4,$8D,$77,$60,$4E,$38,$27,$15,$06,$F7,$E8
   150 00,45F0 DB CF C3 B8 AC +		dta $DB,$CF,$C3,$B8,$AC,$A2,$9A,$90,$88,$7F,$78,$70,$6A,$64,$5E,$00
   151 					EIF
   152 00,4600					org PLAYER-$100-$100
   153 00,4600			frqtab
   154 					ERT [<frqtab]!=0	;* frqtab must begin at the memory page bound! (i.e. $..00 address)
   155 00,4600			frqtabbass1
   156 00,4600 BF B6 AA A1 98 +		dta $BF,$B6,$AA,$A1,$98,$8F,$89,$80,$F2,$E6,$DA,$CE,$BF,$B6,$AA,$A1
   157 00,4610 98 8F 89 80 7A +		dta $98,$8F,$89,$80,$7A,$71,$6B,$65,$5F,$5C,$56,$50,$4D,$47,$44,$3E
   158 00,4620 3C 38 35 32 2F +		dta $3C,$38,$35,$32,$2F,$2D,$2A,$28,$25,$23,$21,$1F,$1D,$1C,$1A,$18
   159 00,4630 17 16 14 13 12 +		dta $17,$16,$14,$13,$12,$11,$10,$0F,$0E,$0D,$0C,$0B,$0A,$09,$08,$07
   160 00,4640			frqtabbass2
   161 00,4640 FF F1 E4 D8 CA +		dta $FF,$F1,$E4,$D8,$CA,$C0,$B5,$AB,$A2,$99,$8E,$87,$7F,$79,$73,$70
   162 00,4650 66 61 5A 55 52 +		dta $66,$61,$5A,$55,$52,$4B,$48,$43,$3F,$3C,$39,$37,$33,$30,$2D,$2A
   163 00,4660 28 25 24 21 1F +		dta $28,$25,$24,$21,$1F,$1E,$1C,$1B,$19,$17,$16,$15,$13,$12,$11,$10
   164 00,4670 0F 0E 0D 0C 0B +		dta $0F,$0E,$0D,$0C,$0B,$0A,$09,$08,$07,$06,$05,$04,$03,$02,$01,$00
   165 00,4680			frqtabpure
   166 00,4680 F3 E6 D9 CC C1 +		dta $F3,$E6,$D9,$CC,$C1,$B5,$AD,$A2,$99,$90,$88,$80,$79,$72,$6C,$66
   167 00,4690 60 5B 55 51 4C +		dta $60,$5B,$55,$51,$4C,$48,$44,$40,$3C,$39,$35,$32,$2F,$2D,$2A,$28
   168 00,46A0 25 23 21 1F 1D +		dta $25,$23,$21,$1F,$1D,$1C,$1A,$18,$17,$16,$14,$13,$12,$11,$10,$0F
   169 00,46B0 0E 0D 0C 0B 0A +		dta $0E,$0D,$0C,$0B,$0A,$09,$08,$07,$06,$05,$04,$03,$02,$01,$00,$00
   170 					IFT FEAT_BASS16
   171 00,46C0			frqtabbasshi
   172 00,46C0 0D 0D 0C 0B 0B +		dta $0D,$0D,$0C,$0B,$0B,$0A,$0A,$09,$08,$08,$07,$07,$07,$06,$06,$05
   173 00,46D0 05 05 04 04 04 +		dta $05,$05,$04,$04,$04,$04,$03,$03,$03,$03,$03,$02,$02,$02,$02,$02
   174 00,46E0 02 02 01 01 01 +		dta $02,$02,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$00,$00
   175 00,46F0 00 00 00 00 00 +		dta $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
   176 					EIF
   177 00,4700					org PLAYER-$0100
   178 00,4700			volumetab
   179 00,4700 00 00 00 00 00 +		dta $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
   180 00,4710 00 00 00 00 00 +		dta $00,$00,$00,$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$01,$01
   181 00,4720 00 00 00 00 01 +		dta $00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$01,$01,$02,$02,$02,$02
   182 00,4730 00 00 00 01 01 +		dta $00,$00,$00,$01,$01,$01,$01,$01,$02,$02,$02,$02,$02,$03,$03,$03
   183 00,4740 00 00 01 01 01 +		dta $00,$00,$01,$01,$01,$01,$02,$02,$02,$02,$03,$03,$03,$03,$04,$04
   184 00,4750 00 00 01 01 01 +		dta $00,$00,$01,$01,$01,$02,$02,$02,$03,$03,$03,$04,$04,$04,$05,$05
   185 00,4760 00 00 01 01 02 +		dta $00,$00,$01,$01,$02,$02,$02,$03,$03,$04,$04,$04,$05,$05,$06,$06
   186 00,4770 00 00 01 01 02 +		dta $00,$00,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$06,$06,$07,$07
   187 00,4780 00 01 01 02 02 +		dta $00,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$06,$06,$07,$07,$08
   188 00,4790 00 01 01 02 02 +		dta $00,$01,$01,$02,$02,$03,$04,$04,$05,$05,$06,$07,$07,$08,$08,$09
   189 00,47A0 00 01 01 02 03 +		dta $00,$01,$01,$02,$03,$03,$04,$05,$05,$06,$07,$07,$08,$09,$09,$0A
   190 00,47B0 00 01 01 02 03 +		dta $00,$01,$01,$02,$03,$04,$04,$05,$06,$07,$07,$08,$09,$0A,$0A,$0B
   191 00,47C0 00 01 02 02 03 +		dta $00,$01,$02,$02,$03,$04,$05,$06,$06,$07,$08,$09,$0A,$0A,$0B,$0C
   192 00,47D0 00 01 02 03 03 +		dta $00,$01,$02,$03,$03,$04,$05,$06,$07,$08,$09,$0A,$0A,$0B,$0C,$0D
   193 00,47E0 00 01 02 03 04 +		dta $00,$01,$02,$03,$04,$05,$06,$07,$07,$08,$09,$0A,$0B,$0C,$0D,$0E
   194 00,47F0 00 01 02 03 04 +		dta $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$0A,$0B,$0C,$0D,$0E,$0F
   195 00,4800				org PLAYER
   196 				;*
   197 				;* Set of RMT main vectors:
   198 				;*
   199 00,4800			RASTERMUSICTRACKER
   200 00,4800 4C 0F 48			jmp rmt_init
   201 00,4803 4C FD 49			jmp rmt_play
   202 00,4806 4C 24 4A			jmp rmt_p3
   203 00,4809 4C 58 48			jmp rmt_silence
   204 00,480C 4C 2E 4D			jmp SetPokey
   205 00,480F			rmt_init
   206 00,480F 86 D3			stx ns
   207 00,4811 84 D4			sty ns+1
   208 00,4813 48			pha
   209 					IFT track_endvariables-track_variables>255
   210 					ldy #0
   211 					tya
   212 				ri0	sta track_variables,y
   213 					sta track_endvariables-$100,y
   214 					iny
   215 					bne ri0
   216 					ELS
   217 00,4814 A0 AD			ldy #track_endvariables-track_variables
   218 00,4816 A9 00			lda #0
   219 00,4818 99 7F 44		ri0	sta track_variables-1,y
   220 00,481B 88			dey
   221 00,481C D0 FA			bne ri0
   222 					EIF
   223 00,481E A0 04			ldy #4
   224 00,4820 B1 D3			lda (ns),y
   225 00,4822 8D 2B 45			sta v_maxtracklen
   226 00,4825 C8			iny
   227 00,4826 B1 D3			lda (ns),y
   228 00,4828 8D 26 45			sta v_speed
   229 00,482B C8			iny
   230 00,482C B1 D3			lda (ns),y
   231 00,482E 8D 29 45			sta v_instrspeed
   232 00,4831 8D 2A 45			sta v_ainstrspeed
   233 00,4834 A0 08			ldy #8
   234 00,4836 B1 D3		ri1	lda (ns),y
   235 00,4838 99 C3 00			sta p_tis-8,y
   236 00,483B C8			iny
   237 00,483C C0 10			cpy #8+8
   238 00,483E D0 F6			bne ri1
   239 00,4840 68			pla
   240 00,4841 48			pha
   241 					IFT TRACKS>4
   242 					asl @
   243 					asl @
   244 					asl @
   245 					clc
   246 					adc p_song
   247 					sta p_song
   248 					pla
   249 					php
   250 					and #$e0
   251 					asl @
   252 					rol @
   253 					rol @
   254 					rol @
   255 					ELS
   256 00,4842 0A			asl @
   257 00,4843 0A			asl @
   258 00,4844 18			clc
   259 00,4845 65 D1			adc p_song
   260 00,4847 85 D1			sta p_song
   261 00,4849 68			pla
   262 00,484A 08			php
   263 00,484B 29 C0			and #$c0
   264 00,484D 0A			asl @
   265 00,484E 2A			rol @
   266 00,484F 2A			rol @
   267 					EIF
   268 00,4850 28			plp
   269 00,4851 65 D2			adc p_song+1
   270 00,4853 85 D2			sta p_song+1
   271 00,4855 20 6E 48			jsr GetSongLineTrackLineInitOfNewSetInstrumentsOnlyRmtp3
   272 00,4858			rmt_silence
   273 					IFT STEREOMODE>0
   274 					lda #0
   275 					sta $d208
   276 					sta $d218
   277 					ldy #3
   278 					sty $d20f
   279 					sty $d21f
   280 					ldy #8
   281 				si1	sta $d200,y
   282 					sta $d210,y
   283 					dey
   284 					bpl si1
   285 					ELS
   286 00,4858 A9 00			lda #0
   287 00,485A 8D 08 D2			sta $d208
   288 00,485D A0 03			ldy #3
   289 00,485F 8C 0F D2			sty $d20f
   290 00,4862 A0 08			ldy #8
   291 00,4864 99 00 D2		si1	sta $d200,y
   292 00,4867 88			dey
   293 00,4868 10 FA			bpl si1
   294 					EIF
   295 00,486A AD 29 45			lda v_instrspeed
   296 00,486D 60			rts
   297 00,486E			GetSongLineTrackLineInitOfNewSetInstrumentsOnlyRmtp3
   298 00,486E			GetSongLine
   299 00,486E A2 00			ldx #0
   300 00,4870 8E 2C 45			stx v_abeat
   301 00,4873			nn0
   302 00,4873 8A		nn1	txa
   303 00,4874 A8			tay
   304 00,4875 B1 D1			lda (p_song),y
   305 00,4877 C9 FE			cmp #$fe
   306 00,4879 B0 2D			bcs nn2
   307 00,487B A8			tay
   308 00,487C B1 CD			lda (p_trackslbstable),y
   309 00,487E 9D 80 44			sta trackn_db,x
   310 00,4881 B1 CF			lda (p_trackshbstable),y
   311 00,4883 9D 84 44		nn1a sta trackn_hb,x
   312 00,4886 A9 00			lda #0
   313 00,4888 9D 88 44			sta trackn_idx,x
   314 00,488B A9 01			lda #1
   315 00,488D 9D 8C 44		nn1a2 sta trackn_pause,x
   316 00,4890 A9 80			lda #$80
   317 00,4892 9D B4 44			sta trackn_instrx2,x
   318 00,4895 E8			inx
   319 00,4896 E0 04		xtracks01	cpx #TRACKS
   320 00,4898 D0 D9			bne nn1
   321 00,489A A5 D1			lda p_song
   322 00,489C 18			clc
   323 00,489D 69 04		xtracks02	adc #TRACKS
   324 00,489F 85 D1			sta p_song
   325 00,48A1 90 1B			bcc GetTrackLine
   326 00,48A3 E6 D2			inc p_song+1
   327 00,48A5			nn1b
   328 00,48A5 4C BE 48			jmp GetTrackLine
   329 00,48A8			nn2
   330 00,48A8 F0 04			beq nn3
   331 00,48AA			nn2a
   332 00,48AA A9 00			lda #0
   333 00,48AC F0 DF			beq nn1a2
   334 00,48AE			nn3
   335 00,48AE A0 02			ldy #2
   336 00,48B0 B1 D1			lda (p_song),y
   337 00,48B2 AA			tax
   338 00,48B3 C8			iny
   339 00,48B4 B1 D1			lda (p_song),y
   340 00,48B6 85 D2			sta p_song+1
   341 00,48B8 86 D1			stx p_song
   342 00,48BA A2 00			ldx #0
   343 00,48BC F0 B5			beq nn0
   344 00,48BE			GetTrackLine
   345 00,48BE			oo0
   346 00,48BE			oo0a
   347 00,48BE AD 26 45			lda v_speed
   348 00,48C1 8D 28 45			sta v_bspeed
   349 00,48C4 A2 FF			ldx #-1
   350 00,48C6			oo1
   351 00,48C6 E8			inx
   352 00,48C7 DE 8C 44			dec trackn_pause,x
   353 00,48CA D0 45			bne oo1x
   354 00,48CC			oo1b
   355 00,48CC BD 80 44			lda trackn_db,x
   356 00,48CF 85 D3			sta ns
   357 00,48D1 BD 84 44			lda trackn_hb,x
   358 00,48D4 85 D4			sta ns+1
   359 00,48D6			oo1i
   360 00,48D6 BC 88 44			ldy trackn_idx,x
   361 00,48D9 FE 88 44			inc trackn_idx,x
   362 00,48DC B1 D3			lda (ns),y
   363 00,48DE 85 D9			sta reg1
   364 00,48E0 29 3F			and #$3f
   365 00,48E2 C9 3D			cmp #61
   366 00,48E4 F0 11			beq oo1a
   367 00,48E6 B0 39			bcs oo2
   368 00,48E8 9D 90 44			sta trackn_note,x
   369 					IFT FEAT_BASS16
   370 00,48EB 9D 10 45			sta trackn_outnote,x
   371 					EIF
   372 00,48EE C8			iny
   373 00,48EF B1 D3			lda (ns),y
   374 00,48F1 4A			lsr @
   375 00,48F2 29 7E			and #$3f*2
   376 00,48F4 9D B4 44			sta trackn_instrx2,x
   377 00,48F7			oo1a
   378 00,48F7 A9 01			lda #1
   379 00,48F9 9D 8C 44			sta trackn_pause,x
   380 00,48FC BC 88 44			ldy trackn_idx,x
   381 00,48FF FE 88 44			inc trackn_idx,x
   382 00,4902 B1 D3			lda (ns),y
   383 00,4904 4A			lsr @
   384 00,4905 66 D9			ror reg1
   385 00,4907 4A			lsr @
   386 00,4908 66 D9			ror reg1
   387 00,490A A5 D9			lda reg1
   388 00,490C 29 F0			and #$f0
   389 00,490E 9D 94 44			sta trackn_volume,x
   390 00,4911			oo1x
   391 00,4911 E0 03		xtracks03sub1	cpx #TRACKS-1
   392 00,4913 D0 B1			bne oo1
   393 00,4915 AD 28 45			lda v_bspeed
   394 00,4918 8D 26 45			sta v_speed
   395 00,491B 8D 27 45			sta v_aspeed
   396 00,491E 4C 66 49			jmp InitOfNewSetInstrumentsOnly
   397 00,4921			oo2
   398 00,4921 C9 3F			cmp #63
   399 00,4923 F0 1B			beq oo63
   400 00,4925 A5 D9			lda reg1
   401 00,4927 29 C0			and #$c0
   402 00,4929 F0 09			beq oo62_b
   403 00,492B 0A			asl @
   404 00,492C 2A			rol @
   405 00,492D 2A			rol @
   406 00,492E 9D 8C 44			sta trackn_pause,x
   407 00,4931 4C 11 49			jmp oo1x
   408 00,4934			oo62_b
   409 00,4934 C8			iny
   410 00,4935 B1 D3			lda (ns),y
   411 00,4937 9D 8C 44			sta trackn_pause,x
   412 00,493A FE 88 44			inc trackn_idx,x
   413 00,493D 4C 11 49			jmp oo1x
   414 00,4940			oo63
   415 00,4940 A5 D9			lda reg1
   416 00,4942 30 0C			bmi oo63_1X
   417 00,4944 C8			iny
   418 00,4945 B1 D3			lda (ns),y
   419 00,4947 8D 28 45			sta v_bspeed
   420 00,494A FE 88 44			inc trackn_idx,x
   421 00,494D 4C D6 48			jmp oo1i
   422 00,4950			oo63_1X
   423 00,4950 C9 FF			cmp #255
   424 00,4952 F0 09			beq oo63_11
   425 00,4954 C8			iny
   426 00,4955 B1 D3			lda (ns),y
   427 00,4957 9D 88 44			sta trackn_idx,x
   428 00,495A 4C D6 48			jmp oo1i
   429 00,495D			oo63_11
   430 00,495D 4C 6E 48			jmp GetSongLine
   431 00,4960 4C 24 4A		p2xrmtp3	jmp rmt_p3
   432 00,4963 CA		p2x0 dex
   433 00,4964 30 FA			 bmi p2xrmtp3
   434 00,4966			InitOfNewSetInstrumentsOnly
   435 00,4966 BC B4 44		p2x1 ldy trackn_instrx2,x
   436 00,4969 30 F8			bmi p2x0
   437 00,496B			SetUpInstrumentY2
   438 00,496B B1 CB			lda (p_instrstable),y
   439 00,496D 9D B8 44			sta trackn_instrdb,x
   440 00,4970 85 D7			sta nt
   441 00,4972 C8			iny
   442 00,4973 B1 CB			lda (p_instrstable),y
   443 00,4975 9D BC 44			sta trackn_instrhb,x
   444 00,4978 85 D8			sta nt+1
   445 					IFT FEAT_FILTER
   446 00,497A A9 01			lda #1
   447 00,497C 9D 14 45			sta trackn_filter,x
   448 					EIF
   449 					IFT FEAT_TABLEGO
   450 					IFT FEAT_FILTER
   451 00,497F A8			tay
   452 					ELS
   453 					ldy #1
   454 					EIF
   455 00,4980 B1 D7			lda (nt),y
   456 00,4982 9D 04 45			sta trackn_tablelop,x
   457 00,4985 C8			iny
   458 					ELS
   459 					ldy #2
   460 					EIF
   461 00,4986 B1 D7			lda (nt),y
   462 00,4988 9D C4 44			sta trackn_instrlen,x
   463 00,498B C8			iny
   464 00,498C B1 D7			lda (nt),y
   465 00,498E 9D C8 44			sta trackn_instrlop,x
   466 00,4991 C8			iny
   467 00,4992 B1 D7			lda (nt),y
   468 00,4994 9D F0 44			sta trackn_tabletypespeed,x
   469 					IFT FEAT_TABLETYPE||FEAT_TABLEMODE
   470 00,4997 29 3F			and #$3f
   471 					EIF
   472 00,4999 9D 08 45			sta trackn_tablespeeda,x
   473 					IFT FEAT_TABLEMODE
   474 00,499C B1 D7			lda (nt),y
   475 00,499E 29 40			and #$40
   476 00,49A0 9D F4 44			sta trackn_tablemode,x
   477 					EIF
   478 					IFT FEAT_AUDCTLMANUALSET
   479 00,49A3 C8			iny
   480 00,49A4 B1 D7			lda (nt),y
   481 00,49A6 9D 20 45			sta trackn_audctl,x
   482 00,49A9 C8			iny
   483 					ELS
   484 					ldy #6
   485 					EIF
   486 00,49AA B1 D7			lda (nt),y
   487 00,49AC 9D D0 44			sta trackn_volumeslidedepth,x
   488 					IFT FEAT_VOLUMEMIN
   489 00,49AF C8			iny
   490 00,49B0 B1 D7			lda (nt),y
   491 00,49B2 9D D8 44			sta trackn_volumemin,x
   492 00,49B5 C8			iny
   493 					ELS
   494 					ldy #8
   495 					EIF
   496 00,49B6 B1 D7			lda (nt),y
   497 00,49B8 9D DC 44			sta trackn_effdelay,x
   498 00,49BB C8			iny
   499 00,49BC B1 D7			lda (nt),y
   500 00,49BE A8			tay
   501 00,49BF B9 A0 45			lda vibtabbeg,y
   502 00,49C2 9D E0 44			sta trackn_effvibratoa,x
   503 00,49C5 9D E4 44			sta trackn_effvibratobeg,x
   504 00,49C8 B9 A1 45			lda vibtabbeg+1,y
   505 00,49CB 9D E8 44			sta trackn_effvibratoend,x
   506 00,49CE A0 0A			ldy #10
   507 00,49D0 B1 D7			lda (nt),y
   508 00,49D2 9D EC 44			sta trackn_effshift,x
   509 00,49D5 A9 80			lda #128
   510 00,49D7 9D D4 44			sta trackn_volumeslidevalue,x
   511 00,49DA 9D B4 44			sta trackn_instrx2,x
   512 00,49DD 0A			asl @
   513 00,49DE 9D CC 44			sta trackn_instrreachend,x
   514 00,49E1 9D 9C 44			sta trackn_shiftfrq,x
   515 00,49E4 A8			tay
   516 00,49E5 B1 D7			lda (nt),y
   517 00,49E7 9D 00 45			sta trackn_tableend,x
   518 00,49EA 69 00			adc #0
   519 00,49EC 9D C0 44			sta trackn_instridx,x
   520 00,49EF A9 0C			lda #INSTRPAR
   521 00,49F1 9D FC 44			sta trackn_tablea,x
   522 00,49F4 A8			tay
   523 00,49F5 B1 D7			lda (nt),y
   524 00,49F7 9D F8 44			sta trackn_tablenote,x
   525 00,49FA			xata_rtshere
   526 00,49FA 4C 63 49			jmp p2x0
   527 00,49FD			rmt_play
   528 00,49FD			rmt_p0
   529 00,49FD 20 2E 4D			jsr SetPokey
   530 00,4A00			rmt_p1
   531 00,4A00 CE 2A 45			dec v_ainstrspeed
   532 00,4A03 D0 1F			bne rmt_p3
   533 00,4A05			p1a
   534 00,4A05 AD 29 45			lda v_instrspeed
   535 00,4A08 8D 2A 45			sta v_ainstrspeed
   536 00,4A0B			rmt_p2
   537 00,4A0B CE 27 45			dec v_aspeed
   538 00,4A0E D0 14			bne rmt_p3
   539 00,4A10 EE 2C 45			inc v_abeat
   540 00,4A13 AD 2C 45			lda v_abeat
   541 00,4A16 CD 2B 45			cmp v_maxtracklen
   542 00,4A19 F0 03			beq p2o3
   543 00,4A1B 4C BE 48			jmp GetTrackLine
   544 00,4A1E			p2o3
   545 00,4A1E 4C 6E 48			jmp GetSongLineTrackLineInitOfNewSetInstrumentsOnlyRmtp3
   546 00,4A21 4C 62 4C		go_ppnext	jmp ppnext
   547 00,4A24			rmt_p3
   548 00,4A24 A9 46			lda #>frqtab
   549 00,4A26 85 D6			sta nr+1
   550 00,4A28 A2 03		xtracks05sub1	ldx #TRACKS-1
   551 00,4A2A			pp1
   552 00,4A2A BD BC 44			lda trackn_instrhb,x
   553 00,4A2D F0 F2			beq go_ppnext
   554 00,4A2F 85 D4			sta ns+1
   555 00,4A31 BD B8 44			lda trackn_instrdb,x
   556 00,4A34 85 D3			sta ns
   557 00,4A36 BC C0 44			ldy trackn_instridx,x
   558 00,4A39 B1 D3			lda (ns),y
   559 00,4A3B 85 D9			sta reg1
   560 00,4A3D C8			iny
   561 00,4A3E B1 D3			lda (ns),y
   562 00,4A40 85 DA			sta reg2
   563 00,4A42 C8			iny
   564 00,4A43 B1 D3			lda (ns),y
   565 00,4A45 85 DB			sta reg3
   566 00,4A47 C8			iny
   567 00,4A48 98			tya
   568 00,4A49 DD C4 44			cmp trackn_instrlen,x
   569 00,4A4C 90 0A			bcc pp2
   570 00,4A4E F0 08			beq pp2
   571 00,4A50 A9 80			lda #$80
   572 00,4A52 9D CC 44			sta trackn_instrreachend,x
   573 00,4A55			pp1b
   574 00,4A55 BD C8 44			lda trackn_instrlop,x
   575 00,4A58 9D C0 44		pp2	sta trackn_instridx,x
   576 00,4A5B A5 D9			lda reg1
   577 					IFT TRACKS>4
   578 					cpx #4
   579 					bcc pp2s
   580 					lsr @
   581 					lsr @
   582 					lsr @
   583 					lsr @
   584 				pp2s
   585 					EIF
   586 00,4A5D 29 0F			and #$0f
   587 00,4A5F 1D 94 44			ora trackn_volume,x
   588 00,4A62 A8			tay
   589 00,4A63 B9 00 47			lda volumetab,y
   590 00,4A66 85 DC			sta tmp
   591 00,4A68 A5 DA			lda reg2
   592 00,4A6A 29 0E			and #$0e
   593 00,4A6C A8			tay
   594 00,4A6D B9 90 45			lda tabbeganddistor,y
   595 00,4A70 85 D5			sta nr
   596 00,4A72 A5 DC			lda tmp
   597 00,4A74 19 91 45			ora tabbeganddistor+1,y
   598 00,4A77 9D 1C 45			sta trackn_audc,x
   599 00,4A7A			InstrumentsEffects
   600 00,4A7A BD DC 44			lda trackn_effdelay,x
   601 00,4A7D F0 28			beq ei2
   602 00,4A7F C9 01			cmp #1
   603 00,4A81 D0 21			bne ei1
   604 00,4A83 BD 9C 44			lda trackn_shiftfrq,x
   605 00,4A86 18			clc
   606 00,4A87 7D EC 44			adc trackn_effshift,x
   607 00,4A8A 18			clc
   608 00,4A8B BC E0 44			ldy trackn_effvibratoa,x
   609 00,4A8E 79 A5 45			adc vib0,y
   610 00,4A91 9D 9C 44			sta trackn_shiftfrq,x
   611 00,4A94 C8			iny
   612 00,4A95 98			tya
   613 00,4A96 DD E8 44			cmp trackn_effvibratoend,x
   614 00,4A99 D0 03			bne ei1a
   615 00,4A9B BD E4 44			lda trackn_effvibratobeg,x
   616 00,4A9E			ei1a
   617 00,4A9E 9D E0 44			sta trackn_effvibratoa,x
   618 00,4AA1 4C A7 4A			jmp ei2
   619 00,4AA4			ei1
   620 00,4AA4 DE DC 44			dec trackn_effdelay,x
   621 00,4AA7			ei2
   622 00,4AA7 BC 00 45			ldy trackn_tableend,x
   623 00,4AAA C0 0D			cpy #INSTRPAR+1
   624 00,4AAC 90 3C			bcc ei3
   625 00,4AAE BD 08 45			lda trackn_tablespeeda,x
   626 00,4AB1 10 31			bpl ei2f
   627 00,4AB3			ei2c
   628 00,4AB3 98			tya
   629 00,4AB4 DD FC 44			cmp trackn_tablea,x
   630 00,4AB7 D0 08			bne ei2c2
   631 					IFT FEAT_TABLEGO
   632 00,4AB9 BD 04 45			lda trackn_tablelop,x
   633 					ELS
   634 					lda #INSTRPAR
   635 					EIF
   636 00,4ABC 9D FC 44			sta trackn_tablea,x
   637 00,4ABF D0 03			bne ei2a
   638 00,4AC1			ei2c2
   639 00,4AC1 FE FC 44			inc trackn_tablea,x
   640 00,4AC4			ei2a
   641 00,4AC4 BD B8 44			lda trackn_instrdb,x
   642 00,4AC7 85 D7			sta nt
   643 00,4AC9 BD BC 44			lda trackn_instrhb,x
   644 00,4ACC 85 D8			sta nt+1
   645 00,4ACE BC FC 44			ldy trackn_tablea,x
   646 00,4AD1 B1 D7			lda (nt),y
   647 					IFT FEAT_TABLEMODE
   648 00,4AD3 BC F4 44			ldy trackn_tablemode,x
   649 00,4AD6 F0 04			beq ei2e
   650 00,4AD8 18			clc
   651 00,4AD9 7D F8 44			adc trackn_tablenote,x
   652 00,4ADC			ei2e
   653 					EIF
   654 00,4ADC 9D F8 44			sta trackn_tablenote,x
   655 00,4ADF BD F0 44			lda trackn_tabletypespeed,x
   656 					IFT FEAT_TABLETYPE||FEAT_TABLEMODE
   657 00,4AE2 29 3F			and #$3f
   658 					EIF
   659 00,4AE4			ei2f
   660 00,4AE4 38			sec
   661 00,4AE5 E9 01			sbc #1
   662 00,4AE7 9D 08 45			sta trackn_tablespeeda,x
   663 00,4AEA			ei3
   664 00,4AEA BD CC 44			lda trackn_instrreachend,x
   665 00,4AED 10 1F			bpl ei4
   666 00,4AEF BD 94 44			lda trackn_volume,x
   667 00,4AF2 F0 1A			beq ei4
   668 					IFT FEAT_VOLUMEMIN
   669 00,4AF4 DD D8 44			cmp trackn_volumemin,x
   670 00,4AF7 F0 15			beq ei4
   671 00,4AF9 90 13			bcc ei4
   672 					EIF
   673 00,4AFB A8			tay
   674 00,4AFC BD D4 44			lda trackn_volumeslidevalue,x
   675 00,4AFF 18			clc
   676 00,4B00 7D D0 44			adc trackn_volumeslidedepth,x
   677 00,4B03 9D D4 44			sta trackn_volumeslidevalue,x
   678 00,4B06 90 06			bcc ei4
   679 00,4B08 98			tya
   680 00,4B09 E9 10			sbc #16
   681 00,4B0B 9D 94 44			sta trackn_volume,x
   682 00,4B0E			ei4
   683 					IFT FEAT_COMMAND2
   684 00,4B0E A9 00			lda #0
   685 00,4B10 85 DD			sta frqaddcmd2
   686 					EIF
   687 00,4B12 A5 DA			lda reg2
   688 00,4B14 9D 0C 45			sta trackn_command,x
   689 00,4B17 29 70			and #$70
   690 00,4B19 4A			lsr @
   691 00,4B1A 4A			lsr @
   692 00,4B1B 8D 1F 4B			sta jmx+1
   693 00,4B1E 90 FE		jmx	bcc *
   694 00,4B20 4C D5 4B			jmp cmd0
   695 00,4B23 EA			nop
   696 00,4B24 4C 3F 4B			jmp cmd1
   697 00,4B27 EA			nop
   698 00,4B28 4C 44 4B			jmp cmd2
   699 00,4B2B EA			nop
   700 00,4B2C 4C 4E 4B			jmp cmd3
   701 00,4B2F EA			nop
   702 00,4B30 4C 5A 4B			jmp cmd4
   703 00,4B33 EA			nop
   704 00,4B34 4C 69 4B			jmp cmd5
   705 00,4B37 EA			nop
   706 00,4B38 4C AC 4B			jmp cmd6
   707 00,4B3B EA			nop
   708 00,4B3C 4C BB 4B			jmp cmd7
   709 00,4B3F			cmd1
   710 					IFT FEAT_COMMAND1
   711 00,4B3F A5 DB			lda reg3
   712 00,4B41 4C 18 4C			jmp cmd0c
   713 					EIF
   714 00,4B44			cmd2
   715 					IFT FEAT_COMMAND2
   716 00,4B44 A5 DB			lda reg3
   717 00,4B46 85 DD			sta frqaddcmd2
   718 00,4B48 BD 90 44			lda trackn_note,x
   719 00,4B4B 4C DB 4B			jmp cmd0a
   720 					EIF
   721 00,4B4E			cmd3
   722 					IFT FEAT_COMMAND3
   723 00,4B4E BD 90 44			lda trackn_note,x
   724 00,4B51 18			clc
   725 00,4B52 65 DB			adc reg3
   726 00,4B54 9D 90 44			sta trackn_note,x
   727 00,4B57 4C DB 4B			jmp cmd0a
   728 					EIF
   729 00,4B5A			cmd4
   730 					IFT FEAT_COMMAND4
   731 00,4B5A BD 9C 44			lda trackn_shiftfrq,x
   732 00,4B5D 18			clc
   733 00,4B5E 65 DB			adc reg3
   734 00,4B60 9D 9C 44			sta trackn_shiftfrq,x
   735 00,4B63 BD 90 44			lda trackn_note,x
   736 00,4B66 4C DB 4B			jmp cmd0a
   737 					EIF
   738 00,4B69			cmd5
   739 					IFT FEAT_COMMAND5&&FEAT_PORTAMENTO
   740 					IFT FEAT_TABLETYPE
   741 00,4B69 BD F0 44			lda trackn_tabletypespeed,x
   742 00,4B6C 10 0C			bpl cmd5a1
   743 00,4B6E BC 90 44			ldy trackn_note,x
   744 00,4B71 B1 D5			lda (nr),y
   745 00,4B73 18			clc
   746 00,4B74 7D F8 44			adc trackn_tablenote,x
   747 00,4B77 4C 8A 4B			jmp cmd5ax
   748 					EIF
   749 00,4B7A			cmd5a1
   750 00,4B7A BD 90 44			lda trackn_note,x
   751 00,4B7D 18			clc
   752 00,4B7E 7D F8 44			adc trackn_tablenote,x
   753 00,4B81 C9 3D			cmp #61
   754 00,4B83 90 02			bcc cmd5a2
   755 00,4B85 A9 3F			lda #63
   756 00,4B87			cmd5a2
   757 00,4B87 A8			tay
   758 00,4B88 B1 D5			lda (nr),y
   759 00,4B8A			cmd5ax
   760 00,4B8A 9D A0 44			sta trackn_portafrqc,x
   761 00,4B8D A4 DB			ldy reg3
   762 00,4B8F D0 03			bne cmd5a
   763 00,4B91 9D A4 44			sta trackn_portafrqa,x
   764 00,4B94			cmd5a
   765 00,4B94 98			tya
   766 00,4B95 4A			lsr @
   767 00,4B96 4A			lsr @
   768 00,4B97 4A			lsr @
   769 00,4B98 4A			lsr @
   770 00,4B99 9D A8 44			sta trackn_portaspeed,x
   771 00,4B9C 9D AC 44			sta trackn_portaspeeda,x
   772 00,4B9F A5 DB			lda reg3
   773 00,4BA1 29 0F			and #$0f
   774 00,4BA3 9D B0 44			sta trackn_portadepth,x
   775 00,4BA6 BD 90 44			lda trackn_note,x
   776 00,4BA9 4C DB 4B			jmp cmd0a
   777 					ELI FEAT_COMMAND5
   778 					jmp pp9
   779 					EIF
   780 00,4BAC			cmd6
   781 					IFT FEAT_COMMAND6&&FEAT_FILTER
   782 00,4BAC A5 DB			lda reg3
   783 00,4BAE 18			clc
   784 00,4BAF 7D 14 45			adc trackn_filter,x
   785 00,4BB2 9D 14 45			sta trackn_filter,x
   786 00,4BB5 BD 90 44			lda trackn_note,x
   787 00,4BB8 4C DB 4B			jmp cmd0a
   788 					ELI FEAT_COMMAND6
   789 					jmp pp9
   790 					EIF
   791 00,4BBB			cmd7
   792 					IFT FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY
   793 					IFT FEAT_COMMAND7SETNOTE
   794 00,4BBB A5 DB			lda reg3
   795 					IFT FEAT_COMMAND7VOLUMEONLY
   796 00,4BBD C9 80			cmp #$80
   797 00,4BBF F0 06			beq cmd7a
   798 					EIF
   799 00,4BC1 9D 90 44			sta trackn_note,x
   800 00,4BC4 4C DB 4B			jmp cmd0a
   801 					EIF
   802 					IFT FEAT_COMMAND7VOLUMEONLY
   803 00,4BC7			cmd7a
   804 00,4BC7 BD 1C 45			lda trackn_audc,x
   805 00,4BCA 09 F0			ora #$f0
   806 00,4BCC 9D 1C 45			sta trackn_audc,x
   807 00,4BCF BD 90 44			lda trackn_note,x
   808 00,4BD2 4C DB 4B			jmp cmd0a
   809 					EIF
   810 					EIF
   811 00,4BD5			cmd0
   812 00,4BD5 BD 90 44			lda trackn_note,x
   813 00,4BD8 18			clc
   814 00,4BD9 65 DB			adc reg3
   815 00,4BDB			cmd0a
   816 					IFT FEAT_TABLETYPE
   817 00,4BDB BC F0 44			ldy trackn_tabletypespeed,x
   818 00,4BDE 30 1F			bmi cmd0b
   819 					EIF
   820 00,4BE0 18			clc
   821 00,4BE1 7D F8 44			adc trackn_tablenote,x
   822 00,4BE4 C9 3D			cmp #61
   823 00,4BE6 90 07			bcc cmd0a1
   824 00,4BE8 A9 00			lda #0
   825 00,4BEA 9D 1C 45			sta trackn_audc,x
   826 00,4BED A9 3F			lda #63
   827 00,4BEF			cmd0a1
   828 					IFT FEAT_BASS16
   829 00,4BEF 9D 10 45			sta trackn_outnote,x
   830 					EIF
   831 00,4BF2 A8			tay
   832 00,4BF3 B1 D5			lda (nr),y
   833 00,4BF5 18			clc
   834 00,4BF6 7D 9C 44			adc trackn_shiftfrq,x
   835 					IFT FEAT_COMMAND2
   836 00,4BF9 18			clc
   837 00,4BFA 65 DD			adc frqaddcmd2
   838 					EIF
   839 					IFT FEAT_TABLETYPE
   840 00,4BFC 4C 18 4C			jmp cmd0c
   841 00,4BFF			cmd0b
   842 00,4BFF C9 3D			cmp #61
   843 00,4C01 90 07			bcc cmd0b1
   844 00,4C03 A9 00			lda #0
   845 00,4C05 9D 1C 45			sta trackn_audc,x
   846 00,4C08 A9 3F			lda #63
   847 00,4C0A			cmd0b1
   848 00,4C0A A8			tay
   849 00,4C0B BD 9C 44			lda trackn_shiftfrq,x
   850 00,4C0E 18			clc
   851 00,4C0F 7D F8 44			adc trackn_tablenote,x
   852 00,4C12 18			clc
   853 00,4C13 71 D5			adc (nr),y
   854 					IFT FEAT_COMMAND2
   855 00,4C15 18			clc
   856 00,4C16 65 DD			adc frqaddcmd2
   857 					EIF
   858 					EIF
   859 00,4C18			cmd0c
   860 00,4C18 9D 18 45			sta trackn_audf,x
   861 00,4C1B			pp9
   862 					IFT FEAT_PORTAMENTO
   863 00,4C1B BD AC 44			lda trackn_portaspeeda,x
   864 00,4C1E F0 32			beq pp10
   865 00,4C20 DE AC 44			dec trackn_portaspeeda,x
   866 00,4C23 D0 2D			bne pp10
   867 00,4C25 BD A8 44			lda trackn_portaspeed,x
   868 00,4C28 9D AC 44			sta trackn_portaspeeda,x
   869 00,4C2B BD A4 44			lda trackn_portafrqa,x
   870 00,4C2E DD A0 44			cmp trackn_portafrqc,x
   871 00,4C31 F0 1F			beq pp10
   872 00,4C33 B0 0D			bcs pps1
   873 00,4C35 7D B0 44			adc trackn_portadepth,x
   874 00,4C38 B0 12			bcs pps8
   875 00,4C3A DD A0 44			cmp trackn_portafrqc,x
   876 00,4C3D B0 0D			bcs pps8
   877 00,4C3F 4C 4F 4C			jmp pps9
   878 00,4C42			pps1
   879 00,4C42 FD B0 44			sbc trackn_portadepth,x
   880 00,4C45 90 05			bcc pps8
   881 00,4C47 DD A0 44			cmp trackn_portafrqc,x
   882 00,4C4A B0 03			bcs pps9
   883 00,4C4C			pps8
   884 00,4C4C BD A0 44			lda trackn_portafrqc,x
   885 00,4C4F			pps9
   886 00,4C4F 9D A4 44			sta trackn_portafrqa,x
   887 00,4C52			pp10
   888 00,4C52 A5 DA			lda reg2
   889 00,4C54 29 01			and #$01
   890 00,4C56 F0 0A			beq pp11
   891 00,4C58 BD A4 44			lda trackn_portafrqa,x
   892 00,4C5B 18			clc
   893 00,4C5C 7D 9C 44			adc trackn_shiftfrq,x
   894 00,4C5F 9D 18 45			sta trackn_audf,x
   895 00,4C62			pp11
   896 					EIF
   897 00,4C62			ppnext
   898 00,4C62 CA			dex
   899 00,4C63 30 03			bmi rmt_p4
   900 00,4C65 4C 2A 4A			jmp pp1
   901 00,4C68			rmt_p4
   902 					IFT FEAT_AUDCTLMANUALSET
   903 00,4C68 AD 20 45			lda trackn_audctl+0
   904 00,4C6B 0D 21 45			ora trackn_audctl+1
   905 00,4C6E 0D 22 45			ora trackn_audctl+2
   906 00,4C71 0D 23 45			ora trackn_audctl+3
   907 00,4C74 AA			tax
   908 					ELS
   909 					ldx #0
   910 					EIF
   911 00,4C75			qq1
   912 00,4C75 8E 24 45			stx v_audctl
   913 					IFT FEAT_FILTER
   914 					IFT FEAT_FILTERG0L
   915 00,4C78 AD 0C 45			lda trackn_command+0
   916 00,4C7B 10 21			bpl qq2
   917 00,4C7D AD 1C 45			lda trackn_audc+0
   918 00,4C80 29 0F			and #$0f
   919 00,4C82 F0 1A			beq qq2
   920 00,4C84 AD 18 45			lda trackn_audf+0
   921 00,4C87 18			clc
   922 00,4C88 6D 14 45			adc trackn_filter+0
   923 00,4C8B 8D 1A 45			sta trackn_audf+2
   924 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG2L
   925 00,4C8E AD 1E 45			lda trackn_audc+2
   926 00,4C91 29 10			and #$10
   927 00,4C93 D0 05			bne qq1a
   928 					EIF
   929 00,4C95 A9 00			lda #0
   930 00,4C97 8D 1E 45			sta trackn_audc+2
   931 00,4C9A			qq1a
   932 00,4C9A 8A			txa
   933 00,4C9B 09 04			ora #4
   934 00,4C9D AA			tax
   935 					EIF
   936 00,4C9E			qq2
   937 					IFT FEAT_FILTERG1L
   938 00,4C9E AD 0D 45			lda trackn_command+1
   939 00,4CA1 10 21			bpl qq3
   940 00,4CA3 AD 1D 45			lda trackn_audc+1
   941 00,4CA6 29 0F			and #$0f
   942 00,4CA8 F0 1A			beq qq3
   943 00,4CAA AD 19 45			lda trackn_audf+1
   944 00,4CAD 18			clc
   945 00,4CAE 6D 15 45			adc trackn_filter+1
   946 00,4CB1 8D 1B 45			sta trackn_audf+3
   947 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG3L
   948 00,4CB4 AD 1F 45			lda trackn_audc+3
   949 00,4CB7 29 10			and #$10
   950 00,4CB9 D0 05			bne qq2a
   951 					EIF
   952 00,4CBB A9 00			lda #0
   953 00,4CBD 8D 1F 45			sta trackn_audc+3
   954 00,4CC0			qq2a
   955 00,4CC0 8A			txa
   956 00,4CC1 09 02			ora #2
   957 00,4CC3 AA			tax
   958 					EIF
   959 00,4CC4			qq3
   960 					IFT FEAT_FILTERG0L||FEAT_FILTERG1L
   961 00,4CC4 EC 24 45			cpx v_audctl
   962 00,4CC7 D0 5E			bne qq5
   963 					EIF
   964 					EIF
   965 					IFT FEAT_BASS16
   966 					IFT FEAT_BASS16G1L
   967 00,4CC9 AD 0D 45			lda trackn_command+1
   968 00,4CCC 29 0E			and #$0e
   969 00,4CCE C9 06			cmp #6
   970 00,4CD0 D0 26			bne qq4
   971 00,4CD2 AD 1D 45			lda trackn_audc+1
   972 00,4CD5 29 0F			and #$0f
   973 00,4CD7 F0 1F			beq qq4
   974 00,4CD9 AC 11 45			ldy trackn_outnote+1
   975 00,4CDC B9 C0 45			lda frqtabbasslo,y
   976 00,4CDF 8D 18 45			sta trackn_audf+0
   977 00,4CE2 B9 C0 46			lda frqtabbasshi,y
   978 00,4CE5 8D 19 45			sta trackn_audf+1
   979 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG0L
   980 00,4CE8 AD 1C 45			lda trackn_audc+0
   981 00,4CEB 29 10			and #$10
   982 00,4CED D0 05			bne qq3a
   983 					EIF
   984 00,4CEF A9 00			lda #0
   985 00,4CF1 8D 1C 45			sta trackn_audc+0
   986 00,4CF4			qq3a
   987 00,4CF4 8A			txa
   988 00,4CF5 09 50			ora #$50
   989 00,4CF7 AA			tax
   990 					EIF
   991 00,4CF8			qq4
   992 					IFT FEAT_BASS16G3L
   993 00,4CF8 AD 0F 45			lda trackn_command+3
   994 00,4CFB 29 0E			and #$0e
   995 00,4CFD C9 06			cmp #6
   996 00,4CFF D0 26			bne qq5
   997 00,4D01 AD 1F 45			lda trackn_audc+3
   998 00,4D04 29 0F			and #$0f
   999 00,4D06 F0 1F			beq qq5
  1000 00,4D08 AC 13 45			ldy trackn_outnote+3
  1001 00,4D0B B9 C0 45			lda frqtabbasslo,y
  1002 00,4D0E 8D 1A 45			sta trackn_audf+2
  1003 00,4D11 B9 C0 46			lda frqtabbasshi,y
  1004 00,4D14 8D 1B 45			sta trackn_audf+3
  1005 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG2L
  1006 00,4D17 AD 1E 45			lda trackn_audc+2
  1007 00,4D1A 29 10			and #$10
  1008 00,4D1C D0 05			bne qq4a
  1009 					EIF
  1010 00,4D1E A9 00			lda #0
  1011 00,4D20 8D 1E 45			sta trackn_audc+2
  1012 00,4D23			qq4a
  1013 00,4D23 8A			txa
  1014 00,4D24 09 28			ora #$28
  1015 00,4D26 AA			tax
  1016 					EIF
  1017 					EIF
  1018 00,4D27			qq5
  1019 00,4D27 8E 24 45			stx v_audctl
  1020 					IFT TRACKS>4
  1021 					IFT FEAT_AUDCTLMANUALSET
  1022 					lda trackn_audctl+4
  1023 					ora trackn_audctl+5
  1024 					ora trackn_audctl+6
  1025 					ora trackn_audctl+7
  1026 					tax
  1027 					ELS
  1028 					ldx #0
  1029 					EIF
  1030 					stx v_audctl2
  1031 					IFT FEAT_FILTER
  1032 					IFT FEAT_FILTERG0R
  1033 					lda trackn_command+0+4
  1034 					bpl qs2
  1035 					lda trackn_audc+0+4
  1036 					and #$0f
  1037 					beq qs2
  1038 					lda trackn_audf+0+4
  1039 					clc
  1040 					adc trackn_filter+0+4
  1041 					sta trackn_audf+2+4
  1042 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG2R
  1043 					lda trackn_audc+2+4
  1044 					and #$10
  1045 					bne qs1a
  1046 					EIF
  1047 					lda #0
  1048 					sta trackn_audc+2+4
  1049 				qs1a
  1050 					txa
  1051 					ora #4
  1052 					tax
  1053 					EIF
  1054 				qs2
  1055 					IFT FEAT_FILTERG1R
  1056 					lda trackn_command+1+4
  1057 					bpl qs3
  1058 					lda trackn_audc+1+4
  1059 					and #$0f
  1060 					beq qs3
  1061 					lda trackn_audf+1+4
  1062 					clc
  1063 					adc trackn_filter+1+4
  1064 					sta trackn_audf+3+4
  1065 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG3R
  1066 					lda trackn_audc+3+4
  1067 					and #$10
  1068 					bne qs2a
  1069 					EIF
  1070 					lda #0
  1071 					sta trackn_audc+3+4
  1072 				qs2a
  1073 					txa
  1074 					ora #2
  1075 					tax
  1076 					EIF
  1077 				qs3
  1078 					IFT FEAT_FILTERG0R||FEAT_FILTERG1R
  1079 					cpx v_audctl2
  1080 					bne qs5
  1081 					EIF
  1082 					EIF
  1083 					IFT FEAT_BASS16
  1084 					IFT FEAT_BASS16G1R
  1085 					lda trackn_command+1+4
  1086 					and #$0e
  1087 					cmp #6
  1088 					bne qs4
  1089 					lda trackn_audc+1+4
  1090 					and #$0f
  1091 					beq qs4
  1092 					ldy trackn_outnote+1+4
  1093 					lda frqtabbasslo,y
  1094 					sta trackn_audf+0+4
  1095 					lda frqtabbasshi,y
  1096 					sta trackn_audf+1+4
  1097 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG0R
  1098 					lda trackn_audc+0+4
  1099 					and #$10
  1100 					bne qs3a
  1101 					EIF
  1102 					lda #0
  1103 					sta trackn_audc+0+4
  1104 				qs3a
  1105 					txa
  1106 					ora #$50
  1107 					tax
  1108 					EIF
  1109 				qs4
  1110 					IFT FEAT_BASS16G3R
  1111 					lda trackn_command+3+4
  1112 					and #$0e
  1113 					cmp #6
  1114 					bne qs5
  1115 					lda trackn_audc+3+4
  1116 					and #$0f
  1117 					beq qs5
  1118 					ldy trackn_outnote+3+4
  1119 					lda frqtabbasslo,y
  1120 					sta trackn_audf+2+4
  1121 					lda frqtabbasshi,y
  1122 					sta trackn_audf+3+4
  1123 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG2R
  1124 					lda trackn_audc+2+4
  1125 					and #$10
  1126 					bne qs4a
  1127 					EIF
  1128 					lda #0
  1129 					sta trackn_audc+2+4
  1130 				qs4a
  1131 					txa
  1132 					ora #$28
  1133 					tax
  1134 					EIF
  1135 					EIF
  1136 				qs5
  1137 					stx v_audctl2
  1138 					EIF
  1139 00,4D2A			rmt_p5
  1140 00,4D2A AD 2A 45			lda v_ainstrspeed
  1141 00,4D2D 60			rts
  1142 00,4D2E			SetPokey
  1143 					IFT STEREOMODE==1		;* L1 L2 L3 L4 R1 R2 R3 R4
  1144 					ldy v_audctl2
  1145 					lda trackn_audf+0+4
  1146 					ldx trackn_audf+0
  1147 				xstastx01	sta $d210
  1148 					stx $d200
  1149 					lda trackn_audc+0+4
  1150 					ldx trackn_audc+0
  1151 				xstastx02	sta $d211
  1152 					stx $d201
  1153 					lda trackn_audf+1+4
  1154 					ldx trackn_audf+1
  1155 				xstastx03	sta $d212
  1156 					stx $d202
  1157 					lda trackn_audc+1+4
  1158 					ldx trackn_audc+1
  1159 				xstastx04	sta $d213
  1160 					stx $d203
  1161 					lda trackn_audf+2+4
  1162 					ldx trackn_audf+2
  1163 				xstastx05	sta $d214
  1164 					stx $d204
  1165 					lda trackn_audc+2+4
  1166 					ldx trackn_audc+2
  1167 				xstastx06	sta $d215
  1168 					stx $d205
  1169 					lda trackn_audf+3+4
  1170 					ldx trackn_audf+3
  1171 				xstastx07	sta $d216
  1172 					stx $d206
  1173 					lda trackn_audc+3+4
  1174 					ldx trackn_audc+3
  1175 				xstastx08	sta $d217
  1176 					stx $d207
  1177 					lda v_audctl
  1178 				xstysta01	sty $d218
  1179 					sta $d208
  1180 					ELI STEREOMODE==0		;* L1 L2 L3 L4
  1181 00,4D2E AC 24 45			ldy v_audctl
  1182 00,4D31 AD 18 45			lda trackn_audf+0
  1183 00,4D34 AE 1C 45			ldx trackn_audc+0
  1184 00,4D37 8D 00 D2			sta $d200
  1185 00,4D3A 8E 01 D2			stx $d201
  1186 00,4D3D AD 19 45			lda trackn_audf+1
  1187 00,4D40 AE 1D 45			ldx trackn_audc+1
  1188 00,4D43 8D 02 D2			sta $d200+2
  1189 00,4D46 8E 03 D2			stx $d201+2
  1190 00,4D49 AD 1A 45			lda trackn_audf+2
  1191 00,4D4C AE 1E 45			ldx trackn_audc+2
  1192 00,4D4F 8D 04 D2			sta $d200+4
  1193 00,4D52 8E 05 D2			stx $d201+4
  1194 00,4D55 AD 1B 45			lda trackn_audf+3
  1195 00,4D58 AE 1F 45			ldx trackn_audc+3
  1196 00,4D5B 8D 06 D2			sta $d200+6
  1197 00,4D5E 8E 07 D2			stx $d201+6
  1198 00,4D61 8C 08 D2			sty $d208
  1199 					ELI STEREOMODE==2		;* L1 R2 R3 L4
  1200 					ldy v_audctl
  1201 					lda trackn_audf+0
  1202 					ldx trackn_audc+0
  1203 					sta $d200
  1204 					stx $d201
  1205 					sta $d210
  1206 					lda trackn_audf+1
  1207 					ldx trackn_audc+1
  1208 					sta $d210+2
  1209 					stx $d211+2
  1210 					lda trackn_audf+2
  1211 					ldx trackn_audc+2
  1212 					sta $d210+4
  1213 					stx $d211+4
  1214 					sta $d200+4
  1215 					lda trackn_audf+3
  1216 					ldx trackn_audc+3
  1217 					sta $d200+6
  1218 					stx $d201+6
  1219 					sta $d210+6
  1220 					sty $d218
  1221 					sty $d208
  1222 					ELI STEREOMODE==3		;* L1 L2 R3 R4
  1223 					ldy v_audctl
  1224 					lda trackn_audf+0
  1225 					ldx trackn_audc+0
  1226 					sta $d200
  1227 					stx $d201
  1228 					lda trackn_audf+1
  1229 					ldx trackn_audc+1
  1230 					sta $d200+2
  1231 					stx $d201+2
  1232 					lda trackn_audf+2
  1233 					ldx trackn_audc+2
  1234 					sta $d210+4
  1235 					stx $d211+4
  1236 					sta $d200+4
  1237 					lda trackn_audf+3
  1238 					ldx trackn_audc+3
  1239 					sta $d210+6
  1240 					stx $d211+6
  1241 					sta $d200+6
  1242 					sty $d218
  1243 					sty $d208
  1244 					EIF
  1245 00,4D64 60			rts
  1246 00,4D65			RMTEND
Source: D:\!Atari\getris2\game_over\msx\game_over.asm
    23
    24
    25 00,4D65			start
    26 00,4D65 4C 65 4D			jmp *
    27
    28 00,4D68 A2 00			ldx #<MODUL					;low byte of RMT module to X reg
    29 00,4D6A A0 40			ldy #>MODUL					;hi byte of RMT module to Y reg
    30 00,4D6C A9 00			lda #0						;starting song line 0-255 to A reg
    31 00,4D6E 20 00 48			jsr RASTERMUSICTRACKER		;Init
    32 				;Init returns instrument speed (1..4 => from 1/screen to 4/screen)
    33 00,4D71 A8			tay
    34 00,4D72 B9 9B 4D			lda tabpp-1,y
    35 00,4D75 8D 81 4D			sta acpapx2+1				;sync counter spacing
    36 					
    37 = 00,000E		?tmp	equ 14
    38 					
    39 00,4D78 A9 02			lda #16+0-?tmp
    40 00,4D7A 8D 7E 4D			sta acpapx1+1				;sync counter init
    41 				;
    42 				;	lda #255
    43 				;	sta KEY						;no key pressed
    44 				;
    45
    46 = 00,008E		?last   equ 156-?tmp
    47
    48 00,4D7D			loop
    49 00,4D7D A9 FF		acpapx1	lda #$ff				;parameter overwrite (sync line counter value)
    50 00,4D7F 18			clc
    51 00,4D80 69 FF		acpapx2	adc #$ff				;parameter overwrite (sync line counter spacing)
    52 00,4D82 C9 8E			cmp #?last
    53 00,4D84 90 02			bcc lop4
    54 00,4D86 E9 8E			sbc #?last
    55 00,4D88			lop4
    56 00,4D88 8D 7E 4D			sta acpapx1+1
    57 00,4D8B			waipap
    58 00,4D8B CD 0B D4			cmp VCOUNT					;vertical line counter synchro
    59 00,4D8E D0 FB			bne waipap
    60 					
    61 				;	lda #$0f
    62 				;	sta $d01a
    63
    64 00,4D90 20 03 48			jsr RASTERMUSICTRACKER+3	;1 play
    65 					
    66 				;	lda #0
    67 				;	sta $d01a
    68
    69 00,4D93 AD 10 D0			lda $d010
    70 00,4D96 D0 E5			bne loop					;no => loop
    71
    72 00,4D98			stopmusic
    73 00,4D98 20 09 48			jsr RASTERMUSICTRACKER+9	;all sounds off
    74 00,4D9B 60		        rts
    75
    76 00,4D9C 8E 40 26 19	tabpp	dta ?last , 78-?tmp , 52-?tmp , 39-?tmp		;line counter spacing table for instrument speed from 1 to 4
    77
    78
    79 00,02E0-02E1> 65 4D		run start					;run addr
